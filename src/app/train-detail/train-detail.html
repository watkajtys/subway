<div class="relative flex min-h-screen w-full flex-col bg-background-light dark:bg-background-dark group/design-root overflow-x-hidden" *ngIf="trip() as trip">
  <!-- Top App Bar -->
  <header class="sticky top-0 z-10 flex items-center bg-background-light/80 dark:bg-background-dark/80 p-4 pb-2 justify-between backdrop-blur-sm">
    <div class="flex size-12 shrink-0 items-center text-zinc-900 dark:text-white">
      <a routerLink="/" class="material-symbols-outlined text-2xl">arrow_back</a>
    </div>
    <h1 class="flex-1 text-lg font-bold leading-tight tracking-[-0.015em] text-zinc-900 dark:text-white">
      {{ routeId() }} Train to {{ routeId() | destination:direction() }}
    </h1>
    <div class="flex size-12 shrink-0 items-center justify-end text-zinc-900 dark:text-white">
      <span class="material-symbols-outlined text-2xl">more_vert</span>
    </div>
  </header>
  <!-- Summary Card -->
  <div class="flex items-center gap-4 bg-transparent px-4 min-h-[72px] py-4">
    <div class="flex size-12 shrink-0 items-center justify-center rounded-full" [style.background-color]="lineColor()">
      <span class="text-2xl font-bold text-black">{{ routeId() }}</span>
    </div>
    <div class="flex flex-col justify-center">
      <p class="text-base font-medium leading-normal text-zinc-900 dark:text-white line-clamp-1" *ngIf="nextStop()">
        En Route to {{ nextStop().stopId | stopName }}
      </p>
      <p class="text-sm font-normal leading-normal text-zinc-500 dark:text-zinc-400 line-clamp-2">
        {{ direction() === 'N' ? 'Uptown' : 'Downtown' }}-bound
      </p>
    </div>
  </div>
  <!-- Action Panel / Alert Banner -->
  <div class="p-4 pt-2 @container">
    <div class="flex flex-1 flex-col items-start justify-between gap-4 rounded-xl border border-amber-500/30 bg-amber-500/10 p-5 @[480px]:flex-row @[480px]:items-center">
      <div class="flex w-full items-start gap-3">
        <span class="material-symbols-outlined text-amber-400 mt-0.5">warning</span>
        <div class="flex flex-col gap-1 flex-1">
          <p class="text-base font-bold leading-tight text-zinc-900 dark:text-white">Service Alert: Delays Reported</p>
          <p class="text-base font-normal leading-normal text-zinc-600 dark:text-zinc-300">Signal problems reported near Canal St. Expect delays.</p>
        </div>
        <button class="text-zinc-900 dark:text-white">
          <span class="material-symbols-outlined text-2xl">close</span>
        </button>
      </div>
    </div>
  </div>
  <!-- Vertical Route Timeline -->
  <div class="grid grid-cols-[auto_1fr] gap-x-4 px-4 pb-4">
    <!-- Past Stop -->
    <ng-container *ngIf="mostRecentPastStop()">
      <div class="flex flex-col items-center gap-1 pt-3">
        <div class="flex items-center justify-center rounded-full border-2 border-zinc-500 dark:border-zinc-500 bg-transparent p-1">
          <span class="material-symbols-outlined text-base text-zinc-500 dark:text-zinc-500">check</span>
        </div>
        <div class="w-[2px] grow bg-zinc-300 dark:bg-zinc-700"></div>
      </div>
      <div class="flex flex-1 flex-col py-3 border-b border-zinc-200 dark:border-zinc-800">
        <p class="text-base font-medium leading-normal text-zinc-500 dark:text-zinc-500">
          {{ mostRecentPastStop().stopId | stopName }}
        </p>
        <div class="flex items-center gap-2 mt-1">
          <span class="material-symbols-outlined text-lg text-zinc-500 dark:text-zinc-500" title="Accessibility" *ngIf="isAccessible(mostRecentPastStop().stopId!)">accessible</span>
          <div class="flex items-center gap-1.5">
            <app-route-badge *ngFor="let route of getTransfersForStop(mostRecentPastStop().stopId!)" [routeId]="route"></app-route-badge>
          </div>
        </div>
      </div>
    </ng-container>

    <!-- Current Progress -->
    <div class="flex flex-col items-center gap-0">
      <div class="w-[2px] h-8 bg-zinc-300 dark:bg-zinc-700"></div>
      <div class="text-zinc-900 dark:text-white z-10 my-[-4px]">
        <span class="material-symbols-outlined text-3xl !font-bold" [style.color]="lineColor()">train</span>
      </div>
      <div class="w-[2px] grow" [style.background-color]="lineColor()"></div>
    </div>
    <div class="flex flex-1 flex-col py-3 border-b border-zinc-200 dark:border-zinc-800">
      <!-- This is a spacer for the moving train icon -->
    </div>

    <!-- Upcoming Stops -->
    <ng-container *ngFor="let stop of futureStops(); let i = index">
      <div class="flex flex-col items-center gap-1">
        <div class="w-[2px] h-2" [style.background-color]="i === 0 ? lineColor() : '#444'"></div>
        <div class="box-border flex size-6 items-center justify-center rounded-full border-2" [class.border-zinc-300]="i > 0" [class.dark:border-zinc-700]="i > 0" [style.border-color]="i === 0 ? lineColor() : ''" [style.background-color]="i === 0 ? (lineColor() + '10') : 'transparent'">
          <div *ngIf="i === 0" class="size-2.5 rounded-full" [style.background-color]="lineColor()"></div>
        </div>
        <div class="w-[2px] grow bg-zinc-300 dark:bg-zinc-700"></div>
      </div>
      <div class="flex flex-1 items-center justify-between py-3 border-b border-zinc-200 dark:border-zinc-800">
        <div>
          <p class="text-base font-medium leading-normal text-zinc-900 dark:text-white">
            {{ stop.stopId | stopName }}
          </p>
          <div class="flex items-center gap-2 mt-1" *ngIf="getTransfersForStop(stop.stopId!).length > 0 || isAccessible(stop.stopId!)">
            <span class="material-symbols-outlined text-lg text-zinc-500 dark:text-zinc-400" title="Accessibility" *ngIf="isAccessible(stop.stopId!)">accessible</span>
            <div class="flex items-center gap-1.5">
              <app-route-badge *ngFor="let route of getTransfersForStop(stop.stopId!)" [routeId]="route"></app-route-badge>
            </div>
          </div>
        </div>
        <p class="text-base font-medium leading-normal" [class.text-primary]="i === 0" [class.text-zinc-500]="i > 0" [class.dark:text-zinc-400]="i > 0">
          {{ stop.arrival?.time | arrivalTime }}
        </p>
      </div>
    </ng-container>
  </div>
</div>
